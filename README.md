# Сервис записи на консультации

Простой сервис для распределения консультаций между студентами и экспертами. Реализован на FastAPI (Python) + SQLite и статическом интерфейсе на ванильном JavaScript.

## Возможности

- **Студенты**: просматривают экспертов и их свободные слоты (первый месяц показывается по умолчанию), записываются на консультацию, получают код отмены, могут освободить слот по своему коду.
- **Администратор**: проходит страницу входа `/admin/login` по секретному коду (по умолчанию `admin-secret`), после чего добавляет/редактирует экспертов, пакетно назначает или правит слоты, фильтрует записи по эксперту, редактирует запросы студентов и удаляет записи.
- **Эксперты**: проходят страницу входа `/expert/login` по секретному коду (по умолчанию `expert-secret`), после чего выбирают себя из списка и видят свои слоты с заявками студентов и текстами их запросов.

## Быстрый старт

```bash
cd /Users/tagirminnakhmetov/НК
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
uvicorn app.main:app --reload
```

После запуска статические страницы доступны на одном домене:

- [http://localhost:8000/](http://localhost:8000/) — лендинг с навигацией.
- `/student` — интерфейс для студентов.
- `/expert` — кабинет эксперта.
- `/admin` — страница администратора (нужен `ADMIN_TOKEN`).

Все страницы отдаются тем же приложением.

## Пароли для доступа

| Страница | Пароль по умолчанию |
|----------|---------------------|
| Администратор (`/admin/login`) | `admin-secret` |
| Эксперт (`/expert/login`) | `expert-secret` |

**Важно:** Эти пароли можно изменить через переменные окружения `ADMIN_TOKEN` и `EXPERT_TOKEN`.

## Переменные окружения

| Переменная | Назначение | Значение по умолчанию |
|------------|------------|------------------------|
| `DATABASE_URL` | путь к базе (SQLite) | `sqlite:///./data/consultations.db` |
| `ADMIN_TOKEN` | токен администратора для защищённых эндпоинтов | `admin-secret` |
| `EXPERT_TOKEN` | токен эксперта для доступа к странице эксперта | `expert-secret` |
| `CORS_ORIGINS` | разрешённые origin'ы (через запятую) | `*` |

Меняйте их перед запуском, если нужно.

## Основные эндпоинты

| Метод | Путь | Описание |
|-------|------|----------|
| `GET /experts` | Список экспертов + их слоты |
| `POST /experts` | Добавление эксперта (требуется `X-Admin-Token`) |
| `PATCH /experts/{expert_id}` | Обновление информации об эксперте (админ) |
| `DELETE /experts/{expert_id}` | Удаление эксперта вместе с его слотами (админ) |
| `GET /slots` | Все слоты со статусом |
| `POST /slots` | Добавление одиночного слота (админ) |
| `POST /slots/batch` | Пакетное создание слотов по диапазону (админ) |
| `PATCH /slots/{slot_id}` | Изменение свободного слота (админ) |
| `DELETE /slots/{slot_id}` | Удаление свободного слота (админ) |
| `POST /slots/{slot_id}/book` | Запись студента на слот |
| `DELETE /bookings/{booking_id}` | Удаление записи с кодом отмены |
| `GET /bookings` | Полный список записей (админ) |
| `DELETE /admin/bookings/{booking_id}` | Удаление записи админом |
| `PATCH /admin/bookings/{booking_id}` | Редактирование заявки (админ) |
| `GET /experts/{expert_id}/bookings` | Список записей конкретного эксперта |

## Как работать с UI

1. **Студент** открывает `/student`, выбирает слот, заполняет форму и получает ID записи с кодом отмены.
2. Для отмены он вводит ID и код на той же странице — слот снова становится доступен другим.
3. **Админ** сначала открывает `/admin/login`, вводит код, затем переходит на `/admin`, создаёт/редактирует/удаляет экспертов, назначает им слоты (включая пакетное разбиение периода), фильтрует и обновляет записи.
4. **Эксперт** открывает `/expert`, выбирает себя в выпадающем списке и видит все заявки с контактами и вопросами студентов.

## Тестовые данные

По умолчанию база пустая. Добавьте первых экспертов и слоты через админскую форму или запросами к API.

## Деплой

- **Деплой на Render.com (супер подробно для новичков):** максимально детальная инструкция в файле [DEPLOY_RENDER_DETAILED.md](DEPLOY_RENDER_DETAILED.md) ⭐ **САМЫЙ ПРОСТОЙ ВАРИАНТ - РЕКОМЕНДУЕТСЯ!**
- **Деплой на Timeweb VPS (супер подробно для новичков):** максимально детальная инструкция в файле [DEPLOY_TIMEWEB_DETAILED.md](DEPLOY_TIMEWEB_DETAILED.md)
- **Деплой на обычный веб-хостинг (Railway, Render, PythonAnywhere):** инструкция для начинающих в файле [DEPLOY_SHARED_HOSTING.md](DEPLOY_SHARED_HOSTING.md)
- **Деплой на VPS Timeweb (краткая версия):** инструкция в файле [DEPLOY.md](DEPLOY.md)
- **Деплой на Yandex Cloud VPS:** пошаговая инструкция для новичков в файле [DEPLOY_YANDEX_CLOUD.md](DEPLOY_YANDEX_CLOUD.md)

